@import turqey.entity._
@import turqey.html._
@import turqey.view._
@import turqey.utils.Implicits._

@(article: Article, owner: User, tags: Seq[Tag], comments: Seq[ArticleComment], stocked: Boolean)
<html>
  @css()
  <body>
  <script type="text/javascript" src="@assets/vender/js/materialize.js"></script>
  <script type="text/javascript" src="@assets/vender/js/knockout.js"></script>
    @topnav {
    <div class="">
      <div class="container">
        <div class="row">
          <div class="col s8">
            <p>
              <span>@article.title</span>
            <p>
            <p>
              <span>@owner.name が @{article.created.toString("yyyy/MM/dd")} に投稿</span>
            </p>
            <p>
            @tags.map { tag =>
              <div class="chip">
                <a href="@root/tag/@tag.id">@tag.name</a>
              </div>
            }
            </p>
            <p>
            <a href="/article/@article.id/edit" class="waves-effect waves-light btn"><i class="material-icons right">edit</i>編集</a>
            </p>
          </div>
          <div class="col s4" id="divStock">
            <p>
              <button type="button"
                class="waves-effect waves-light btn"
                style="display: none"
                data-bind="click: toggleStock, visible: stocked"><i class="material-icons right">cancel</i>解除</button>
              <button type="button"
                class="waves-effect waves-light btn"
                style="display: none"
                data-bind="click: toggleStock, visible: !stocked()"><i class="material-icons right">folder</i>ストック</button>
            <p>
          </div>
        </div>
      </div>
    </div>
    } 
    <div class="container">
      <div>@Html(Markdown.html(article.content))</div>
      <hr>
      <div>
        <div class="row">
          <div class="col s10">
            <i class="material-icons">comment</i>コメント
          </div>
        </div>
        <div class="row">
          @comments.map { comment =>
          <div class="card">
            <div class="card-content">
            <span class="card-title">@comment.created.toString("yyyy/MM/dd")</span>
              @Html(Markdown.html(comment.content))
            </div>
          </div>
          }
        </div>
        <div class="row">
          <form action="./@article.id/comment" method="post">
            <div class="input-field col s12">
              <textarea name="comment" class="materialize-textarea" placeholder="Markdown" id="input_comment"></textarea>
              <label>Comment</label>
            </div>
            <div class="input-field col s12">
              <button type="submit" class="waves-effect waves-light btn"><i class="material-icons right">send</i>コメント</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </body>
<script>
var ViewModel = function (initialState){
  var self = this;
  self.stocked = ko.observable(initialState);
  self.toggleStock = function(obj, e){
    $.post('./@article.id/stock', function(){
      self.stocked(!self.stocked());
    });
  };
};

// Activates knockout.js
var vm = new ViewModel(@{Html(stocked.toString)});
ko.applyBindings(vm, document.getElementById('divStock'));
//$('#btnStock').on('click', function(){ $.post('./@article.id/stock'); }); 
</script>
</html>

