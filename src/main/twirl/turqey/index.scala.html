@import turqey.entity._
@import turqey.servlet._
@import turqey.controller._
@import turqey.utils.Json

@(articles: Seq[Article], stocks: Seq[scala.Long], tagsByArticleId: scala.collection.immutable.Map[scala.Long, Seq[(scala.Long, Tag)]])
<html>
  @css()
  <body>
    <script type="text/javascript" src="@assets/vender/js/materialize.js"></script>
    <script type="text/javascript" src="@assets/vender/js/knockout.js"></script>
    @topnav()
    <main>
    <div class="container" id="container">
      <p>CSV知識を共有しよう。</p>
      <p>
        <a href="@root/article/edit" class="waves-effect waves-light btn"><i class="material-icons right">edit</i>新規作成</a>
      </p>
      <div class="row">
        <div class="col s12">
          <ul class="tabs">
            @*
            <li class="tab col s2"><a class="waves-effect" href="#following">フォロー中</a></li>
            *@
            <li class="tab col"><a class="active waves-effect" href="#whole">全ての投稿</a></li>
            @*
            <li class="tab col s2 disabled"><a href="#"></a></li>
            <li class="tab col s2 disabled"><a href="#"></a></li>
            *@
            <li class="tab col"><a class="waves-effect" href="#stock">ストック</a></li>
            <li class="tab col"><a class="waves-effect" href="#own">自分の投稿</a></li>
          </ul>
        </div>
        @*
        <div id="following" class="col s12">W.I.P.</div>
        *@
        <div id="whole" class="col s12">
          @*
          <ul class="pagination" style="text-align: center;">
            <li class="disabled"><a href="#!"><i class="material-icons">chevron_left</i></a></li>
            <li class="active"><a href="#!">1</a></li>
            <li class="waves-effect"><a href="#!">2</a></li>
            <li class="waves-effect"><a href="#!">3</a></li>
            <li class="waves-effect"><a href="#!">4</a></li>
            <li class="waves-effect"><a href="#!">5</a></li>
            <li class="waves-effect"><a href="#!"><i class="material-icons">chevron_right</i></a></li>
          </ul>
          *@
          <!-- ko foreach: articles -->
            <div class="card">
              <div class="card-content">
                <span class="card-title">
                <a class="collection-item waves-effect waves-light" data-bind="text: title, attr: { href: '@root/article/' + id }"></a>
                </span>
                <p>
                  <span data-bind="text: owner.name"></span>
                  <span data-bind="text: created"></span>
                </p>
                <p>
                </p>
              </div>
            </div>
          <!-- /ko -->
        </div>
        <div id="stock" class="col s12">
          @articles.filter( a => stocks.contains(a.id) ).map{ a =>
            <div class="card">
              <div class="card-content">
                <span class="card-title">
                <a href="@root/article/@a.id" class="collection-item waves-effect waves-light">@a.title</a>
                </span>
                <p>
                  @a.owner.get.name @a.created.toString("yyyy/MM/dd")
                </p>
                <p>
                @tagsByArticleId.getOrElse(a.id, Seq()).map { case (id, tag) =>
                  <div class="chip">
                    <a href="@root/tag/@tag.id">@tag.name</a>
                  </div>
                }
                </p>
              </div>
            </div>
          }
        </div>
        <div id="own" class="col s12">
          @articles.filter(a => a.ownerId == SessionHolder.user.get.id).map{ a =>
            <div class="card">
              <div class="card-content">
                <span class="card-title">
                <a href="@root/article/@a.id" class="collection-item waves-effect waves-light">@a.title</a>
                </span>
                <p>
                  @a.owner.get.name @a.created.toString("yyyy/MM/dd")
                </p>
                <p>
                @tagsByArticleId.getOrElse(a.id, Seq()).map { case (id, tag) =>
                  <div class="chip">
                    <a href="@root/tag/@tag.id">@tag.name</a>
                  </div>
                }
                </p>
              </div>
            </div>
          }
        </div>
      </div>
    </div>
    </main>
  </body>
<script>

var ViewModel = function (){
  var self = this;
  
  self.articlesAll = @{Html(Json.toJson( articles.map(_.id).grouped(10).toSeq ))};
  
  self.articles = ko.observableArray(@{Html(Json.toJson( articles ))});
  
};


// Activates knockout.js
var vm = new ViewModel();
ko.applyBindings(vm, document.getElementById('container'));
</script>
</html>
