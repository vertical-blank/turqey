@import turqey.entity._
@import turqey.html._
@import turqey.controller._

@(tag:Tag, articles: Seq[Article], followers: Seq[User] , followed: Boolean)
<html>
  @css()
  <body>
    <script type="text/javascript" src="@assets/vender/js/materialize.js"></script>
  <script type="text/javascript" src="@assets/vender/js/knockout.js"></script>
    @topnav()
    <main>
    <div class="container">
      <div class="row">
        <p>タグ @tag.name の記事一覧</p>
        <p>
          <button type="button"
            class="waves-effect waves-light btn"
            style="display: none"
            data-bind="click: follow, visible: followed"><i class="material-icons right">cancel</i>解除</button>
          <button type="button"
            class="waves-effect waves-light btn"
            style="display: none"
            data-bind="click: follow, visible: !followed()"><i class="material-icons right">star</i>フォロー</button>
        <p>
      </div>
      <div class="row">
        <div id="whole" class="col s12">
          @articles.map{ a =>
          <div class="card">
            <div class="card-content">
              <span class="card-title">
                <a href="@root/article/@a.id">@a.title</a>
              </span>
              <p>
                @a.owner.get.name @a.created.toString("yyyy/MM/dd")
              </p>
            </div>
          </div>
          }
        </div>
      </div>
      <div class="row">
        <p>タグ @tag.name をフォローしているユーザ</p>
        <div class="col s12">
          @followers.map{ u =>
          <div class="card">
            <div class="card-content">
              <span class="card-title">
                <a href="@root/user/@u.id">@u.name</a>
              </span>
            </div>
          </div>
          }
        </div>
      </div>
    </div>
    </main>
  </body>
<script>
var ViewModel = function (initialState){
  var self = this;
  self.followed = ko.observable(initialState);
  self.follow = function(obj, e){
    $.post('@root/tag/@tag.id/follow', function(dat){
      self.followed(!self.followed());
    });
  };
};

var vm = new ViewModel(@{Html(followed.toString)});
ko.applyBindings(vm);
</script>
</html>

